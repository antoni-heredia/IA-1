<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">

  <category>
    <pattern>comprobar si la fruta es *</pattern>
    <template>
      <condition name = "frutaelegida">
        <li value = "unknown">
           <think>
             <!--Escoge una fruta aleatoria-->
             <set var = "lista_frutas"> <readset>frutas</readset> </set>
             <set name = "frutas"> <get var = "lista_frutas" /> </set>
             <set var = "cantidad"><srai>COUNT <get name = "frutas"/></srai></set>
             <set var = "posicion"><srai>RANDOM <get var = "cantidad"/></srai></set>
             <set name = "frutaelegida" >
              <srai>
                 SELECTITEM <get var = "posicion"/> IN <get name = "frutas"/>
              </srai>
             </set>
             <!--Cargamos las claves en una variable-->
             <set var = "boolean"> <readset>caracteristicasboolean</readset> </set>
             <set var = "noboolean"> <readset>caracteristicasnoboolean</readset> </set>
             <!--incia el contador y la salida para los campos no boleanos-->
             <set var="contador">1</set>
             <set var="salida">
               <!--ponemos en la variable salida el tamaño de la lista + 1 que sera cuando pare el bucle-->
               <map name="successor"><srai>COUNT <get var = "boolean"/></srai></map>
             </set>
          </think>

          <condition var="contador">
            <!--cuando el contador coincida con el tamaño mas 1 sale-->
            <li>
              <value><get var="salida"/></value>
              <!--se elimina el unknow que se tenia desde el principio-->
              <think>
                <set name = "caracteristicasfruta">
                  <srai>
                    REMOVEITEM <srai>COUNT <get name = "caracteristicasfruta"/></srai> IN <get name = "caracteristicasfruta" />
                  </srai>
               </set>
             </think>
            </li>
            <!--cuerpo principal del bucle-->
            <li>
              <think>

                <!--se selecciona el campo en la posicion que marca el contador-->
                <set var = "campo" >
                 <srai>
                    SELECTITEM <get var = "contador"/> IN <get var = "noboolean"/>
                 </srai>
                </set>

                <!--se selecciona el valor de la key del fichero map de la fruta elegida-->
                <set var = "valorcampo">
                  <map><name><get name = "frutaelegida" /></name><get var = "campo" /></map>
                </set>

                <!--se añade a las caracteristicas de la fruta-->
                <set name = "caracteristicasfruta">
                  <srai>
                    ADDITEM <get var = "valorcampo" /> IN <get name = "caracteristicasfruta" />
                  </srai>
                </set>
                <!--Se aumenta el contador-->
                <set var="contador">
                  <map name="successor"><get var="contador"/></map>
                </set>
              </think>
              <loop/>

            </li>
          </condition>
       <think>
          <!--incia el contador y la salida para los campos booleanos-->
          <set var="contador">1</set>
          <set var="salida">
            <!--ponemos en la variable salida el tamaño de la lista + 1 que sera cuando pare el bucle-->
            <map name="successor"><srai>COUNT <get var = "boolean"/></srai></map>
          </set>
       </think>

       <condition var="contador">
         <!--cuando el contador coincida con el tamaño mas 1 sale-->
         <li>
           <value><get var="salida"/></value>
         </li>
         <!--cuerpo principal del bucle-->
         <li>
           <think>

             <!--se selecciona el campo en la posicion que marca el contador-->
             <set var = "campo" >
              <srai>
                 SELECTITEM <get var = "contador"/> IN <get var = "boolean"/>
              </srai>
             </set>

             <!--se selecciona el valor de la key del fichero map de la fruta elegida-->
             <set var = "valorcampo">
               <map><name><get name = "frutaelegida" /></name><get var = "campo" /></map>
             </set>
             <condition var = "valorcampo">
               <li value="si">
                 <!--se añade a las caracteristicas de la fruta-->
                 <set name = "caracteristicasfruta">
                   <srai>
                     ADDITEM <get var = "campo" /> IN <get name = "caracteristicasfruta" />
                   </srai>
                 </set>
              </li>
              <li></li>
            </condition>
             <!--Se aumenta el contador-->
             <set var="contador">
               <map name="successor"><get var="contador"/></map>
             </set>
           </think>
           <loop/>
         </li>
       </condition>
        </li>
        <li>

         <get name = "frutaelegida" /> <get name = "caracteristicasfruta"/>
       </li>
      </condition>
    </template>
  </category>

  <category>
    <pattern>hola</pattern>
    <template>
      holaa <get name = "frutaelegida" />
    </template>
  </category>

  <category>
    <pattern>adios</pattern>
    <template>
      <srai>comprobar si la fruta es *</srai>
    </template>
  </category>

  <category>
    <pattern>es *</pattern>
    <template>
      <!--Se mira si corresponde con la fruta que fue elegida por el bot-->
      <think>
        <set var = "pos">
          <srai>FINDITEM <star/> IN <get name = "frutaelegida"/></srai>
        </set>
      </think>
        <condition var = "pos">
          <li value="0">
            <!--Si no lo es se pasa a mirar si es una de sus caracteristicas-->
            <think>
              <set var = "pos">
                <srai>FINDITEM <star/> IN <get name = "caracteristicasfruta"/></srai>
              </set>
            </think>

            <condition var = "pos">
              <li value="0">
                no
              </li>
              <li>
                si
              </li>
            </condition>
          </li>
          <li>
            si
          </li>
        </condition>

    </template>
  </category>

</aiml>
