<?xml version="1.0" encoding="UTF-8"?>
<aiml version="2.0">
<!--Escoge una fruta aleatoria-->
  <category>
    <pattern>iniciar eleccion de fruta</pattern>
    <template>
      <condition name = "frutaelegida">
        <li value = "unknown">
           <think>
             <!--Escoge una fruta aleatoria-->
             <set var = "lista_frutas"> <readset>frutas</readset> </set>
             <set name = "frutas"> <get var = "lista_frutas" /> </set>
             <set var = "cantidad"><srai>COUNT <get name = "frutas"/></srai></set>
             <set var = "posicion"><srai>RANDOM <get var = "cantidad"/></srai></set>
             <set name = "frutaelegida" >
              <srai>
                 SELECTITEM <get var = "posicion"/> IN <get name = "frutas"/>
              </srai>
             </set>

             <set name = "caracteristicasfruta">
               <srai>
                cargar map de la fruta <get name = "frutaelegida" />
               </srai>
             </set>
          </think>

        </li>
        <li>

       </li>
      </condition>
    </template>
  </category>

  <category>
    <pattern>mostrar fruta elegida</pattern>
    <template>
      <get name = "frutaelegida" />
    </template>
  </category>
  <category>
    <pattern>mostrar caracteristicas fruta elegida</pattern>
    <template>
      <get name = "caracteristicasfruta"/>
    </template>
  </category>

<!--Se usa para ver si la fruta elegida por el bot tiene una determinada caracteristica-->
  <category>
    <pattern>caracteristica fruta elegida *</pattern>
    <template>
      <!--Se mira si corresponde con la fruta que fue elegida por el bot-->
      <think>
        <set var = "pos">
          <srai>FINDITEM <star/> IN <get name = "frutaelegida"/></srai>
        </set>
      </think>
        <condition var = "pos">
          <li value="0">
            <!--Si no lo es se pasa a mirar si es una de sus caracteristicas-->
            <think>
              <set var = "pos">
                <srai>FINDITEM <star/> IN <get name = "caracteristicasfruta"/></srai>
              </set>
            </think>

            <condition var = "pos">
              <li value="0">
                no
              </li>
              <li>
                si
              </li>
            </condition>
          </li>
          <li>
            si, acerto la fruta
          </li>
        </condition>

    </template>
  </category>
<!-- se encarga de la ayuda y se le pasa la fruta y la caracteristica-->
  <category>
    <pattern>fruta * caracteristica *</pattern>
    <template>
      <set var = "caracteristicasfruta">
        <srai>cargar map de la fruta <star/></srai>
      </set>
      <condition var = "caracteristicasfruta">
        <li value="no">
          no
        </li>
        <li>
           <!--Si no lo es se pasa a mirar si es una de sus caracteristicas-->
         <think>
           <set var = "pos">
             <srai>FINDITEM <star index = "2"/> IN <get var = "caracteristicasfruta"/></srai>
           </set>
         </think>
         <condition var = "pos">
           <li value="0">
             no
           </li>
           <li>
             si
           </li>
         </condition>

        </li>
      </condition>
    </template>
  </category>
  <!--Pregunta sobre la caracteristica de la fruta-->
  <category>
    <pattern>la fruta es *</pattern>
    <template>
      <srai>caracteristica fruta elegida <star/></srai>
    </template>
  </category>

  <category>
    <pattern>cargar map de la fruta *</pattern>
    <template>
      <think>
        <!--Se carga el set de frutas y se mira si esta corresponde con alguna-->
        <set var = "lista_frutas"> <readset>frutas</readset> </set>
        <set var = "frutas"> <get var = "lista_frutas" /> </set>
        <set var = "pos">
          <srai>FINDITEM <star/> IN <get var = "frutas"/></srai>
        </set>
      </think>
      <condition var = "pos">
        <li value="0">
          no
        </li>
        <!--si corresponde se pasa a mirar si tiene es propiedad-->
        <li>
          <think>
            <!--Cargamos las claves en una variable-->
            <set var = "boolean"> <readset>caracteristicasboolean</readset> </set>
            <set var = "noboolean"> <readset>caracteristicasnoboolean</readset> </set>
            <!--incia el contador y la salida para los campos no boleanos-->
            <set var="contador">1</set>
            <set var="salida">
              <!--ponemos en la variable salida el tamaño de la lista + 1 que sera cuando pare el bucle-->
              <map name="successor"><srai>COUNT <get var = "boolean"/></srai></map>
            </set>
          </think>
          <condition var="contador">
              <!--cuando el contador coincida con el tamaño mas 1 sale-->
              <li>
                <value><get var="salida"/></value>
                <!--se elimina el unknow que se tenia desde el principio-->
                <think>
                  <set var = "caracteristicasfruta">
                    <srai>
                      REMOVEITEM <srai>COUNT <get var = "caracteristicasfruta"/></srai> IN <get var = "caracteristicasfruta" />
                    </srai>
                 </set>
               </think>
              </li>
              <!--cuerpo principal del bucle-->
              <li>

                <think>

                  <!--se selecciona el campo en la posicion que marca el contador-->
                  <set var = "campo" >
                   <srai>
                      SELECTITEM <get var = "contador"/> IN <get var = "noboolean"/>
                   </srai>
                  </set>

                  <!--se selecciona el valor de la key del fichero map de la fruta elegida-->
                  <set var = "valorcampo">
                    <map><name><srai>SELECTITEM <get var = "pos"/> IN <get var = "frutas"/></srai></name><get var = "campo" /></map>
                  </set>

                  <!--se añade a las caracteristicas de la fruta-->
                  <set var = "caracteristicasfruta">
                    <srai>
                      ADDITEM <get var = "valorcampo" /> IN <get var = "caracteristicasfruta" />
                    </srai>
                  </set>
                  <!--Se aumenta el contador-->
                  <set var="contador">
                    <map name="successor"><get var="contador"/></map>
                  </set>
                </think>



                <loop/>

              </li>
            </condition>

         <think>
            <!--incia el contador y la salida para los campos booleanos-->
            <set var="contador">1</set>
            <set var="salida">
              <!--ponemos en la variable salida el tamaño de la lista + 1 que sera cuando pare el bucle-->
              <map name="successor"><srai>COUNT <get var = "boolean"/></srai></map>
            </set>
         </think>

         <condition var="contador">
           <!--cuando el contador coincida con el tamaño mas 1 sale-->
           <li>
             <value><get var="salida"/></value>
           </li>
           <!--cuerpo principal del bucle-->
           <li>
             <think>

               <!--se selecciona el campo en la posicion que marca el contador-->
               <set var = "campo" >
                <srai>
                   SELECTITEM <get var = "contador"/> IN <get var = "boolean"/>
                </srai>
               </set>

               <!--se selecciona el valor de la key del fichero map de la fruta elegida-->
               <set var = "valorcampo">
                 <map><name><srai>SELECTITEM <get var = "pos"/> IN <get var = "frutas"/></srai></name><get var = "campo" /></map>
               </set>
               <condition var = "valorcampo">
                 <li value="si">
                   <!--se añade a las caracteristicas de la fruta-->
                   <set var = "caracteristicasfruta">
                     <srai>
                       ADDITEM <get var = "campo" /> IN <get var = "caracteristicasfruta" />
                     </srai>
                   </set>
                </li>
                <li></li>
              </condition>
               <!--Se aumenta el contador-->
               <set var="contador">
                 <map name="successor"><get var="contador"/></map>
               </set>
             </think>
             <loop/>
           </li>
         </condition>
         <get var = "caracteristicasfruta"/>
       </li>
     </condition>
    </template>
  </category>

  <category>
    <pattern>map fruta *</pattern>
    <template>
      <set var = "corqueta">
        <srai>cargar map de la fruta <star/></srai>
      </set>
      <condition var = "croqueta">
        <li value = "unknow">
          fallos
        </li>
        <li>dentro</li>
      </condition>
      <get var = "croqueta"/>

    </template>
  </category>

  <category>
    <pattern>es *</pattern>
    <template>
      <srai>caracteristica fruta elegida <star/></srai>
    </template>
  </category>

  <category>
    <pattern>^ tiene vitamina *</pattern>
    <template>
      <srai>caracteristica fruta elegida <star/></srai>
    </template>
  </category>

  <category>
    <pattern>el * es *</pattern>
    <template>
      <srai>ayuda <star/> <star index = "2"/></srai>
    </template>
  </category>

  <category>
    <pattern>es [el la] *</pattern>
    <template>
      <srai>caracteristica fruta elegida <star/></srai>
    </template>
  </category>


</aiml>
